from blurring_as_a_service.utils.azure_coco_to_yolo_converter import (
    AzureCocoToYoloConverter,
)


def expected_output():
    """
    Returns expected YOLO conversion of file: TMX7315080123-000286_pano_0000_001145.txt.

    Returns
    -------
    list
        Expected YOLO conversion.
    """
    return [
        "0 0.8529828361939678 0.6214242070765983 0.035966227850913746 0.14969727267677613 29\n",
        "0 0.38924068210853746 0.5597678164750319 0.018330278286952162 0.03804921401988559 29\n",
        "0 0.4072932289062934 0.5814308726323391 0.014997500416597254 0.08026440037771487 29\n",
        "0 0.41958284730322726 0.5921235349663945 0.02180192190190522 0.08220852080208851 29\n",
        "0 0.3795895128589679 0.6876631672499027 0.06651669166250068 0.14219852246847753 9\n",
        "0 0.3199466755540743 0.6469755040826528 0.031939121257568204 0.11914680886518914 8\n",
        "0 0.30980947619841137 0.5443537188246403 0.010276065100261078 0.028884074876409427 8\n",
        "0 0.33265289118480257 0.5603232794534244 0.011803588290840439 0.04638115869577297 8\n",
        "0 0.31633616619452315 0.5593512192412375 0.024162639560073362 0.08443037271565845 8\n",
        "0 0.3009915014164306 0.5642115203021718 0.013747708715214135 0.03249458423596063 8\n",
        "0 0.2684969171804699 0.5772649002943955 0.016802755096372857 0.0674887518746875 8\n",
        "0 0.2829389546186747 0.5832361273121147 0.026245625729045152 0.06665555740709872 9\n",
        "0 0.1337110481586402 0.5393767705382436 0.009065155807365416 0.06723323890462707 9\n",
        "0 0.23578847969782815 0.5176581680830973 0.004532577903682722 0.025684608120868813 53\n",
        "0 0.2493862134088763 0.5146364494806421 0.004154863078375842 0.022662889518413554 8\n",
        "0 0.27776203966005664 0.5097261567516524 0.003682719546742208 0.009820585457979258 50\n",
        "0 0.27351274787535407 0.5142587346553352 0.003682719546742208 0.019641170915958517 53\n",
        "0 0.4491729530721159 0.5188273864468281 0.004137887131171025 0.011883163043362899 53\n",
        "0 0.4531516906982419 0.5187212867767981 0.004668385481321147 0.013368558423783261 8\n",
        "0 0.46073781710538875 0.5127797052551166 0.0039256877911109656 0.010822166343062656 8\n",
        "0 0.45702432865433784 0.513840701955417 0.003289089770930842 0.01464175446414362 29\n",
        "0 0.47872171117547824 0.5139468016254469 0.00827577426234205 0.01230756172348313 8\n",
        "0 0.534466477809254 0.506137865911237 0.0035882908404154534 0.015486307837582591 8\n",
        "0 0.5518413597733711 0.5103871576959396 0.004532577903682666 0.011898016997167193 32\n",
        "0 0.5581680830972615 0.5098205854579791 0.0037771482530689626 0.012653446647780897 32\n",
        "0 0.6593484419263456 0.5152974504249292 0.0038715769593956617 0.023607176581680878 29\n",
        "0 0.6618508026440038 0.5240793201133145 0.009065155807365444 0.024929178470254887 3\n",
        "1 0.6778092540132201 0.5145420207743154 0.003966005665722361 0.00547686496694999 66\n",
        "0 0.7724740321057602 0.5323890462700661 0.012559017941454198 0.0513692162417374 8\n",
        "0 0.7659584513692163 0.5294617563739377 0.00689329556185081 0.03002832861189808 8\n",
        "0 0.8138474096125221 0.620508634624926 0.0390518717690177 0.1584481682431459 8",
    ]


def test_coco_to_yolo_converter():
    source = "../../local_test_data/in:coco-format/blur_v0.1/validation-tagged.json"
    output_dir = "../../local_test_data/out:yolo-format/blur_v0.1"

    converter = AzureCocoToYoloConverter(source, output_dir)
    converter.convert()

    with open(f"{output_dir}/TMX7316010203-001900_pano_0005_000728.txt", "r") as f:
        assert f.readlines() == expected_output()
